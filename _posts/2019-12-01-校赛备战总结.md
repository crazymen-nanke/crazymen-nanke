---
layout: post
title:  "校赛备战总结"
date:   2019-12-01 8:00:00
categories: Android
tags:  Android
author: NanKe
---

* content
{:toc}
本文主要记录了安卓校赛的练习笔记。



### okHttp使用



```xml
implementation "com.squareup.okhttp3:okhttp:4.2.0"
```



#### 发送一个get请求

```xml
private OkHttpClient client;
String responseData；
```

```java
client = new OkHttpClient();
Request request = new Request.Builder()
        .url(url)
        .build();
Response response = client.newCall(request).execute();

responseData = response.body().string();
```



#### 发送一个post请求

```java
OKHttpClient client = new OkHttpClient();
RequestBody requestBody =FormBody.create(MediaType.parse("application/json",charset=utf-8),json);

Request request = new Request.Builder()
        .url(url)
    	.post(requestBody)
        .build();
Response response = client.newCall(request).execute();
String responseData = response.body().string();
```



#### 封装的方法

```java
 //使用okhttp发送一个get请求，接收一个地址参数
    public static void get(String address, Callback callback) {
        OkHttpClient client = new OkHttpClient();
        Request request = new Request.Builder()
                .url(address)
                .build();
        client.newCall(request).enqueue(callback);
    }

    //    使用okhttp发送一个post请求,接收一个地址参数和一个Json类型的参数
    public static void post(String address, String json, Callback callback) {
        OkHttpClient client = new OkHttpClient();

        RequestBody requestBody = FormBody.create(MediaType.parse("application/json; charset=utf-8"), json);
        Request request = new Request.Builder()
                .url(address)//请求的url
                .post(requestBody)
                .build();
        client.newCall(request).enqueue(callback);
    }
```



AsyncTask中使用的封装方法：

```java
 //    使用okhttp发送一个post请求,接收一个地址参数和一个Json类型的参数
    public static String post(String address, String json) throws IOException {
        OkHttpClient client = new OkHttpClient();

        RequestBody requestBody = FormBody.create(MediaType.parse("application/json; charset=utf-8"), json);
        Request request = new Request.Builder()
                .url(address)//请求的url
                .post(requestBody)
                .build();
        return client.newCall(request).execute().body().string();
    }

```



#### 使用方法

```java
 get("https://tb.crazymen.cn/ziliao/data.json", new Callback() {
            @Override
            public void onFailure(@NotNull Call call, @NotNull IOException e) {

            }

            @Override
            public void onResponse(@NotNull Call call, @NotNull Response response) throws IOException {
                System.out.println(response.body().string());
            }
        });

        post("http://192.168.1.100:8088/transportservice/action/GetAllSense.do", "{\"UserName\":\"user1\"} ", new Callback() {
            @Override
            public void onFailure(@NotNull Call call, @NotNull IOException e) {

            }

            @Override
            public void onResponse(@NotNull Call call, @NotNull Response response) throws IOException {
                System.out.println(response.body().string());
            }
        });
//get地址长期有效，post地址为私网地址，仅供参考
```





### Glide加载图片到ImageView

```xml
repositories {
  mavenCentral()
  google()
}

dependencies {
  implementation 'com.github.bumptech.glide:glide:4.10.0'
  annotationProcessor 'com.github.bumptech.glide:compiler:4.10.0'
}
```



```xml
<uses-permission android:name="android.permission.INTERNET" />
```

```java
Glide.with(Context context).load(Strint url).into(ImageView imageView);
```



### 加载网络视频

activity_main.xml

```xml
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
              android:layout_width="match_parent"
              android:layout_height="match_parent"
              android:orientation="vertical">

    <VideoView
            android:id="@+id/mVideoView"
            android:layout_width="match_parent"
            android:layout_height="match_parent"/>
</LinearLayout>

```



###### MainActivity.java

```java
package com.example.meta;

import android.widget.VideoView;
import androidx.appcompat.app.AppCompatActivity;
import android.os.Bundle;

public class MainActivity extends AppCompatActivity {

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);

        initView();
    }


    private void initView() {
        String url = "https://crazymen.cn/img/%E4%B9%94%E5%B8%83%E6%96%AF2005%E5%B9%B4%E7%BB%8F%E5%85%B8%E6%BC%94%E8%AE%B2.mp4";
        VideoView videoView = findViewById(R.id.mVideoView);
        videoView.setVideoPath(url);
        videoView.requestFocus();
        videoView.start();
    }

}



```



### 加载网络音频

```java
public class MediaPlayerUtil {
  private static volatile MediaPlayerUtil mediaPlayer;

  private MediaPlayerUtil() {
  }

  public static MediaPlayerUtil getMediaPlayer() {
    if (mediaPlayer == null) {
        synchronized (MediaPlayerUtil.class) {
            if (mediaPlayer == null) {
                mediaPlayer = new MediaPlayerUtil();
            }
        }
    }
    return mediaPlayer;
}

private MediaPlayer mPlayer;

/**
 * 播放音频
 *
 * @param songUrl 网络音频Url
 */
public void player(String songUrl) {

    if (TextUtils.equals(songUrl, nowPlaySongUrl)) {
        Log.d(TAG, "player: 重复的url");
        return;
    }
    stopPlay();
    nowPlaySongUrl = songUrl;

    if (mPlayer == null) {
        mPlayer = new MediaPlayer();
    }
    try {
        Log.d(TAG, "player: 当前要播放的歌曲Url === " + songUrl);

        mPlayer.reset();
        //====这种方式只能http，https会抛IO异常
        mPlayer.setDataSource(songUrl);

        mPlayer.prepareAsync();
        mPlayer.setOnPreparedListener(new MediaPlayer.OnPreparedListener() {
            @Override
            public void onPrepared(MediaPlayer mp) {
                Log.d(TAG, "onPrepared: 播放 "+mp.getDuration());
                mp.start();
            }
        });
        mPlayer.setOnCompletionListener(new MediaPlayer.OnCompletionListener() {
            @Override
            public void onCompletion(MediaPlayer mp) {
                nowPlaySongUrl = "";
                if (mPlayer != null)
                    mPlayer.release();
                if (mPlayer != null)
                    mPlayer = null;
            }
        });
    } catch (IOException e) {
        Log.d(TAG, " 播放音乐异常" + e.getMessage());
        ToastUtil.showShort(" 播放音乐异常" + e.getMessage());
    }
}

/**
 * 列表中的音频播放
 * <p>
 * 点击播放，再点击停止
 *
 * @param songUrl
 */
public void playOrStop(String songUrl) {
    if (mPlayer != null) {
        stopPlay();
    } else {
        player(songUrl);
    }
}

/**
 * 停止播放音频，lastSongUrl置空
 */
public void stopPlay() {
    nowPlaySongUrl = "";
    try {
        if (mPlayer != null)
            mPlayer.stop();
        if (mPlayer != null)
            mPlayer.release();
        if (mPlayer != null)
            mPlayer = null;
    } catch (Exception e) {
        Log.e(TAG, "stopPlay: " + e.toString());
    }
}

// 当前播放的音频地址
  private static String nowPlaySongUrl;

  private static String TAG = "TAG.Util.MediaPlay";
}
```



###### 播放音频

```java
 MediaPlayerUtil.getMediaPlayer().player("https://crazymen.cn/Don%20Williams%20-%20Crying%20in%20the%20Rain.mp3");
```



### MPAndroidChart



###### 添加依赖

```xml
repositories {
    maven { url 'https://jitpack.io' }
}

dependencies {
    implementation 'com.github.PhilJay:MPAndroidChart:v3.1.0'
}
```



参考资料： https://blog.csdn.net/wjk343977868/article/details/53316981 



##### 折线图

参考资料： https://blog.csdn.net/a8688555/article/details/80344159 

```xml
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout
        xmlns:android="http://schemas.android.com/apk/res/android"
        xmlns:tools="http://schemas.android.com/tools"
        android:layout_width="match_parent"
        android:layout_height="match_parent"
        tools:context=".Main3Activity">
    <com.github.mikephil.charting.charts.LineChart
            android:id="@+id/chart"
            android:layout_width="match_parent"
            android:layout_height="195dp"
    />
</LinearLayout>
```



```java
package com.example.meta;

import androidx.appcompat.app.AppCompatActivity;
import android.os.Bundle;
import com.github.mikephil.charting.charts.LineChart;
import com.github.mikephil.charting.components.Legend;
import com.github.mikephil.charting.components.XAxis;
import com.github.mikephil.charting.components.YAxis;
import com.github.mikephil.charting.data.Entry;
import com.github.mikephil.charting.data.LineData;
import com.github.mikephil.charting.data.LineDataSet;
import com.github.mikephil.charting.interfaces.datasets.ILineDataSet;

import java.util.ArrayList;
import java.util.List;
import java.util.Random;

//折线图

public class Main3Activity extends AppCompatActivity {

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main3);

        LineChart mLineChart = findViewById(R.id.chart);

        //设置描述
        mLineChart.getDescription().setText("Description");

        //设置x轴和y轴的点
        List<Entry> entries = new ArrayList<>();
        for (int i = 0; i < 12; i++)
            entries.add(new Entry(i, new Random().nextInt(300)));
        LineDataSet dataSet = new LineDataSet(entries, "Label"); // add entries to dataset
        //设置数据
        LineData lineData = new LineData(dataSet);
        mLineChart.setData(lineData);
        mLineChart.notifyDataSetChanged();
        mLineChart.invalidate(); // refresh

        YAxis leftAxis = mLineChart.getAxisLeft();//绑定y轴（左侧）
        YAxis rigthAxis = mLineChart.getAxisRight();//绑定y轴（右侧）
        rigthAxis.setEnabled(false);//隐藏右边y轴

        XAxis xAxis = mLineChart.getXAxis();
        xAxis.setPosition(XAxis.XAxisPosition.BOTTOM);//设置x轴的显示位置

        //去掉网格线
        leftAxis.setDrawGridLines(false);
        xAxis.setDrawGridLines(false);

        //填充颜色
        List<ILineDataSet> setsFilled = mLineChart.getData().getDataSets();
        for (ILineDataSet iSet : setsFilled) {
            LineDataSet set = (LineDataSet) iSet;
            if (set.isDrawFilledEnabled())
                set.setDrawFilled(false);
            else
                set.setDrawFilled(true);
        }
        mLineChart.invalidate();
        //xy轴动画
        mLineChart.animateXY(3000, 3000);

        //设置图例
        Legend legend = mLineChart.getLegend();
        legend.setForm(Legend.LegendForm.LINE); // 线
        legend.setFormSize(14f); // 图形大小
        legend.setFormLineWidth(9f);  // 图形线宽
    }


}
```



![image-20191107103802351](https://zl.crazymen.cn/images/image-20191107103802351.png)





##### 条形图



参考资料： https://blog.csdn.net/weixin_40595516/article/details/82860790 



###### 简单条形图

```xml
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout
        xmlns:android="http://schemas.android.com/apk/res/android"
        android:layout_width="match_parent"
        android:layout_height="match_parent"
        >

    <com.github.mikephil.charting.charts.BarChart
            android:id="@+id/mBarChart"
            android:layout_width="match_parent"
            android:layout_height="match_parent"
           />

</LinearLayout>
```



```java
package com.example.meta;

import android.graphics.Color;
import androidx.appcompat.app.AppCompatActivity;
import android.os.Bundle;
import com.github.mikephil.charting.charts.BarChart;
import com.github.mikephil.charting.components.Description;
import com.github.mikephil.charting.components.XAxis;
import com.github.mikephil.charting.components.YAxis;
import com.github.mikephil.charting.data.BarData;
import com.github.mikephil.charting.data.BarDataSet;
import com.github.mikephil.charting.data.BarEntry;

import java.util.ArrayList;

//条形图
public class Main4Activity extends AppCompatActivity {

    private BarChart mBarChart;
    private BarData mBarData;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main4);

        initView();
        initData();
        initBarChart();

    }

    private void initView() {
        mBarChart = findViewById(R.id.mBarChart);
    }


    //简单的条形图
    private void initData() {

        // y 轴数据
        ArrayList<BarEntry> yValues = new ArrayList<>();
        // 2.0 ----x 轴数据
        // ArrayList<String> xValues = new ArrayList<>();

        for (int x = 0; x < 7; x++) {
            // 2.0 ----xValues.add(String.valueOf(i));
            int y = (int) (Math.random() * 5)+1;
            yValues.add(new BarEntry(x+1, y));
        }

        // y 轴数据集
        BarDataSet barDataSet = new BarDataSet(yValues, "路况分析条形图");

        // 2.0 ---- mBarData = new BarData(xValues, barDataSet);
        mBarData = new BarData(barDataSet);
    }

    private void initBarChart() {
        mBarChart.setData(mBarData);

        //XY轴动画
        mBarChart.animateXY(3000, 3000);
        // 设置 条形图 简介
        Description description = new Description();
        // 可以自定义 位置
        // description.setPosition(200, 200);
        // 也可以 根据 X 轴，Y 轴进行偏移量设置
        description.setXOffset(50f);
        description.setYOffset(10f);
        description.setText("我是 description");
        //不显示描述
        description.setEnabled(false);
        mBarChart.setDescription(description);
        // 设置 是否可以缩放
        mBarChart.setScaleEnabled(false);

        // 设置 柱子的宽度
        // mBarData.setBarWidth(2f);

        // 获取 x 轴
        XAxis xAxis = mBarChart.getXAxis();
        // 设置 x 轴显示位置
        xAxis.setPosition(XAxis.XAxisPosition.BOTTOM);
        // 取消 垂直 网格线
        xAxis.setDrawGridLines(false);
        // 设置 x 轴 坐标旋转角度
        xAxis.setLabelRotationAngle(10f);
        // 设置 x 轴 坐标字体大小
        xAxis.setTextSize(10f);
        // 设置 x 坐标轴 颜色
        xAxis.setAxisLineColor(Color.WHITE);
        // 设置 x 坐标轴 宽度
        xAxis.setAxisLineWidth(2f);
        // 设置 x轴 的刻度数量
        xAxis.setLabelCount(7);

        // 获取 右边 y 轴
        YAxis mRAxis = mBarChart.getAxisRight();
        // 隐藏 右边 Y 轴
        mRAxis.setEnabled(false);
        // 获取 左边 Y轴
        YAxis mLAxis = mBarChart.getAxisLeft();
        // 打开 左边 Y轴 坐标线
        mLAxis.setDrawAxisLine(true);
        // 打开 横向 网格线
        mLAxis.setDrawGridLines(true);
        // 设置 Y轴 的刻度数量
        mLAxis.setLabelCount(5);
        mLAxis.setAxisMinimum(0f);
		
        //设置图例居中
        Legend legend = mBarChart.getLegend();
        legend.setHorizontalAlignment(Legend.LegendHorizontalAlignment.CENTER);//图例水平居中
        legend.setVerticalAlignment(Legend.LegendVerticalAlignment.TOP);//图例在图表上方
        legend.setOrientation(Legend.LegendOrientation.HORIZONTAL);//图例的方向为水平
        legend.setDrawInside(false);//绘制在chart的外侧
        legend.setDirection(Legend.LegendDirection.LEFT_TO_RIGHT);//图例中的文字方向
    }
}
```

![image-20191107112309974](https://zl.crazymen.cn/images/image-20191107112309974.png)



###### 分组条形图



```xml
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout
        xmlns:android="http://schemas.android.com/apk/res/android"
        android:layout_width="match_parent"
        android:layout_height="match_parent"
        >

    <com.github.mikephil.charting.charts.BarChart
            android:id="@+id/mBarChart"
            android:layout_width="match_parent"
            android:layout_height="match_parent"
           />

</LinearLayout>
```



```java
package com.example.meta;

import android.graphics.Color;
import androidx.appcompat.app.AppCompatActivity;
import android.os.Bundle;
import com.github.mikephil.charting.charts.BarChart;
import com.github.mikephil.charting.components.Description;
import com.github.mikephil.charting.components.XAxis;
import com.github.mikephil.charting.components.YAxis;
import com.github.mikephil.charting.data.BarData;
import com.github.mikephil.charting.data.BarDataSet;
import com.github.mikephil.charting.data.BarEntry;

import java.util.ArrayList;

//条形图
public class Main4Activity extends AppCompatActivity {

    private BarChart mBarChart;
    private BarData mBarData;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main4);

        initView();
        initGroupData();
        initBarChart();

    }

    private void initView() {
        mBarChart = findViewById(R.id.mBarChart);
    }

//    分组条形图
    private void initGroupData(){

        // y 数据
        ArrayList<BarEntry> yValues = new ArrayList<>();
        // y2 数据
        ArrayList<BarEntry> yValues2 = new ArrayList<>();

        for (int x = 0; x < 10; x++) {
            float y = (float) (Math.random() * 30) + 10;
            yValues.add(new BarEntry(x, y));

            float y2 = (float) (Math.random() * 30) + 10;
            yValues2.add(new BarEntry(x, y2));
        }

        // y 轴数据集
        BarDataSet barDataSet = new BarDataSet(yValues, "我是黄色");
        barDataSet.setColor(Color.YELLOW);

        // y2 轴数据集
        BarDataSet barDataSet2 = new BarDataSet(yValues2, "我是绿色");
        barDataSet2.setColor(Color.GREEN);

        mBarData = new BarData(barDataSet, barDataSet2);

    }

    private void initBarChart() {
        mBarChart.setData(mBarData);

        // 设置 条形图 简介
        Description description = new Description();
        // 可以自定义 位置
        // description.setPosition(200, 200);
        // 也可以 根据 X 轴，Y 轴进行偏移量设置
        description.setXOffset(50f);
        description.setYOffset(10f);
        description.setText("我是 description");
        mBarChart.setDescription(description);
        // 设置 是否可以缩放
        mBarChart.setScaleEnabled(false);

//         设置 柱子的宽度
//         mBarData.setBarWidth(2f);

        // 获取 x 轴
        XAxis xAxis = mBarChart.getXAxis();
        // 设置 x 轴显示位置
        xAxis.setPosition(XAxis.XAxisPosition.BOTTOM);
        // 取消 垂直 网格线
        xAxis.setDrawGridLines(false);
        // 设置 x 轴 坐标旋转角度
        xAxis.setLabelRotationAngle(10f);
        // 设置 x 轴 坐标字体大小
        xAxis.setTextSize(10f);
        // 设置 x 坐标轴 颜色
        xAxis.setAxisLineColor(Color.WHITE);
        // 设置 x 坐标轴 宽度
        xAxis.setAxisLineWidth(2f);
        // 设置 x轴 的刻度数量
        xAxis.setLabelCount(10);

        // 获取 右边 y 轴
        YAxis mRAxis = mBarChart.getAxisRight();
        // 隐藏 右边 Y 轴
        mRAxis.setEnabled(false);
        // 获取 左边 Y轴
        YAxis mLAxis = mBarChart.getAxisLeft();
        // 取消 左边 Y轴 坐标线
        mLAxis.setDrawAxisLine(false);
        // 取消 横向 网格线
        mLAxis.setDrawGridLines(false);
        // 设置 Y轴 的刻度数量
        mLAxis.setLabelCount(10);
        mLAxis.setAxisMinimum(0f);

        float groupSpace = 0.06f;
        float barSpace = 0.02f;
        float barWidth = 0.45f;
        // 设置 柱子宽度
        mBarData.setBarWidth(barWidth);
        mBarChart.groupBars(0.0f, groupSpace, barSpace);
        // 设置 x 轴 从0开始 默认不是从 0
        xAxis.setAxisMinimum(0);
        // 设置 x 轴 坐标居中显示
        xAxis.setCenterAxisLabels(true);
    }
}

```





![image-20191107090312785](https://zl.crazymen.cn/images/image-20191107090312785.png)





##### 饼图：

```java
package com.example.meta;

import android.graphics.Color;
import android.view.View;
import androidx.appcompat.app.AppCompatActivity;
import android.os.Bundle;
import com.github.mikephil.charting.animation.Easing;
import com.github.mikephil.charting.charts.PieChart;
import com.github.mikephil.charting.components.Legend;
import com.github.mikephil.charting.data.PieData;
import com.github.mikephil.charting.data.PieDataSet;
import com.github.mikephil.charting.data.PieEntry;
import com.github.mikephil.charting.formatter.PercentFormatter;

import java.util.*;

public class Main5Activity extends AppCompatActivity {

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main5);
        
        //获取饼图对象
        PieChart pieChart  = findViewById(R.id.pieChart);
        
        Map<String,Float> map = new HashMap<>();
        
        String data[]={"周一","周二","周三","周四","周五","周六","周日"};
        Float rate[]={22.1f,21.3f,7.7f,8.9f,10.3f,7.5f,22.2f};

        for (int i= 0;i<7;i++){
            map.put(data[i],rate[i]);
        }
        
        //封装好的饼图，
        //饼图对象，数据集合，饼图标题，是否显示图例
        setPieChart(pieChart,map,"星期占比",true);
    }


    public static final int[] PIE_COLORS = {
            Color.rgb(181, 194, 202), Color.rgb(129, 216, 200), Color.rgb(241, 214, 145),
            Color.rgb(108, 176, 223), Color.rgb(195, 221, 155), Color.rgb(251, 215, 191),
            Color.rgb(237, 189, 189), Color.rgb(172, 217, 243)
    };

    /**
     * 设置饼图样式
     *
     * @param pieChart
     * @param pieValues
     * @param title
     * @param showLegend 是否显示图例
     */
    public static void setPieChart(PieChart pieChart, Map<String, Float> pieValues, String title, boolean showLegend) {
        pieChart.setUsePercentValues(true);//设置使用百分比
        pieChart.getDescription().setEnabled(false);//设置描述
        pieChart.setExtraOffsets(20, 15, 20, 15);
        pieChart.setCenterText(title);//设置环中的文字
        pieChart.setCenterTextSize(22f);//设置环中文字的大小
        pieChart.setDrawCenterText(true);//设置绘制环中文字
        pieChart.setRotationAngle(120f);//设置旋转角度

        //图例设置
        Legend legend = pieChart.getLegend();
        if (showLegend) {
            legend.setEnabled(true);
            legend.setHorizontalAlignment(Legend.LegendHorizontalAlignment.CENTER);
            legend.setVerticalAlignment(Legend.LegendVerticalAlignment.TOP);
            legend.setOrientation(Legend.LegendOrientation.HORIZONTAL);
            legend.setDrawInside(false);
            legend.setDirection(Legend.LegendDirection.LEFT_TO_RIGHT);
        } else {
            legend.setEnabled(false);
        }

        //设置饼图数据
        setPieChartData(pieChart, pieValues);

    }

    /**
     * 设置饼图数据源
     */
    private static void setPieChartData(PieChart pieChart, Map<String, Float> pieValues) {
        ArrayList<PieEntry> entries = new ArrayList<>();

        Set set = pieValues.entrySet();
        Iterator it = set.iterator();
        while (it.hasNext()) {
            Map.Entry entry = (Map.Entry) it.next();
            entries.add(new PieEntry(Float.valueOf(entry.getValue().toString()), entry.getKey().toString()));
        }

        PieDataSet dataSet = new PieDataSet(entries, "");
        dataSet.setSliceSpace(3f);//设置饼块之间的间隔
        dataSet.setSelectionShift(5f);//设置饼块选中时偏离饼图中心的距离

        dataSet.setColors(PIE_COLORS);//设置饼块的颜色
        dataSet.setValueLinePart1OffsetPercentage(80f);//数据连接线距图形片内部边界的距离，为百分数
        dataSet.setValueLinePart1Length(0.3f);
        dataSet.setValueLinePart2Length(0.4f);
        dataSet.setValueLineColor(Color.BLUE);//设置连接线的颜色
        dataSet.setYValuePosition(PieDataSet.ValuePosition.OUTSIDE_SLICE);

        PieData pieData = new PieData(dataSet);
        pieData.setValueFormatter(new PercentFormatter());
        pieData.setValueTextSize(11f);
        pieData.setValueTextColor(Color.DKGRAY);

        pieChart.setData(pieData);
        pieChart.highlightValues(null);
        
        pieChart.invalidate();
    }

}

```



```xml
<?xml version="1.0" encoding="utf-8"?>
<RelativeLayout xmlns:android="http://schemas.android.com/apk/res/android"
                android:id="@+id/activity_pie_chart"
                android:layout_width="match_parent"
                android:layout_height="match_parent">
    <com.github.mikephil.charting.charts.PieChart
            android:id="@+id/pieChart"
            android:layout_width="match_parent"
            android:layout_height="match_parent"/>
</RelativeLayout>
```



![image-20191107115109671](https://zl.crazymen.cn/images/image-20191107115109671.png)



###### 动态的饼图

```java
package com.example.meta;

import android.graphics.Color;
import android.os.AsyncTask;
import android.os.CountDownTimer;
import android.view.View;
import androidx.appcompat.app.AppCompatActivity;
import android.os.Bundle;
import com.github.mikephil.charting.animation.Easing;
import com.github.mikephil.charting.charts.PieChart;
import com.github.mikephil.charting.components.Legend;
import com.github.mikephil.charting.data.PieData;
import com.github.mikephil.charting.data.PieDataSet;
import com.github.mikephil.charting.data.PieEntry;
import com.github.mikephil.charting.formatter.PercentFormatter;

import java.util.*;

public class Main5Activity extends AppCompatActivity {

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main5);

        new MyTime(60000,3000).start();
    }


    public static final int[] PIE_COLORS = {
            Color.rgb(181, 194, 202), Color.rgb(129, 216, 200), Color.rgb(241, 214, 145),
            Color.rgb(108, 176, 223), Color.rgb(195, 221, 155), Color.rgb(251, 215, 191),
            Color.rgb(237, 189, 189), Color.rgb(172, 217, 243)
    };

    /**
     * 设置饼图样式
     *
     * @param pieChart
     * @param pieValues
     * @param title
     * @param showLegend 是否显示图例
     */
    public static void setPieChart(PieChart pieChart, Map<String, Float> pieValues, String title, boolean showLegend) {
        pieChart.setUsePercentValues(true);//设置使用百分比
        pieChart.getDescription().setEnabled(false);//设置描述
        pieChart.setExtraOffsets(20, 15, 20, 15);
        pieChart.setCenterText(title);//设置环中的文字
        pieChart.setCenterTextSize(22f);//设置环中文字的大小
        pieChart.setDrawCenterText(true);//设置绘制环中文字
        pieChart.setRotationAngle(120f);//设置旋转角度

        //图例设置
        Legend legend = pieChart.getLegend();
        if (showLegend) {
            legend.setEnabled(true);
            legend.setHorizontalAlignment(Legend.LegendHorizontalAlignment.CENTER);
            legend.setVerticalAlignment(Legend.LegendVerticalAlignment.TOP);
            legend.setOrientation(Legend.LegendOrientation.HORIZONTAL);
            legend.setDrawInside(false);
            legend.setDirection(Legend.LegendDirection.LEFT_TO_RIGHT);
        } else {
            legend.setEnabled(false);
        }

        //设置饼图数据
        setPieChartData(pieChart, pieValues);

    }

    /**
     * 设置饼图数据源
     */
    private static void setPieChartData(PieChart pieChart, Map<String, Float> pieValues) {
        ArrayList<PieEntry> entries = new ArrayList<>();

        Set set = pieValues.entrySet();
        Iterator it = set.iterator();
        while (it.hasNext()) {
            Map.Entry entry = (Map.Entry) it.next();
            entries.add(new PieEntry(Float.valueOf(entry.getValue().toString()), entry.getKey().toString()));
        }

        PieDataSet dataSet = new PieDataSet(entries, "");
        dataSet.setSliceSpace(3f);//设置饼块之间的间隔
        dataSet.setSelectionShift(5f);//设置饼块选中时偏离饼图中心的距离

        dataSet.setColors(PIE_COLORS);//设置饼块的颜色
        dataSet.setValueLinePart1OffsetPercentage(80f);//数据连接线距图形片内部边界的距离，为百分数
        dataSet.setValueLinePart1Length(0.3f);
        dataSet.setValueLinePart2Length(0.4f);
        dataSet.setValueLineColor(Color.BLUE);//设置连接线的颜色
        dataSet.setYValuePosition(PieDataSet.ValuePosition.OUTSIDE_SLICE);

        PieData pieData = new PieData(dataSet);
        pieData.setValueFormatter(new PercentFormatter());
        pieData.setValueTextSize(11f);
        pieData.setValueTextColor(Color.DKGRAY);

        pieChart.setData(pieData);
        pieChart.highlightValues(null);
        pieChart.invalidate();
    }

   class MyTime extends CountDownTimer{


       public MyTime(long millisInFuture, long countDownInterval) {
           super(millisInFuture, countDownInterval);
       }

       @Override
       public void onTick(long millisUntilFinished) {
           PieChart pieChart  = findViewById(R.id.pieChart);
           Map<String,Float> map = new HashMap<>();
           String data[]={"周一","周二","周三","周四","周五","周六","周日"};


           for (int i= 0;i<7;i++){
               map.put(data[i],new Random().nextFloat());
           }
           setPieChart(pieChart,map,"星期占比",true);
       }

       @Override
       public void onFinish() {
           cancel();
       }
   }

}

```







### ViewPage的使用：

```xml
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout
        xmlns:android="http://schemas.android.com/apk/res/android"
        xmlns:tools="http://schemas.android.com/tools"
        android:layout_width="match_parent"
        android:layout_height="match_parent"
        tools:context=".Main6Activity">
    <androidx.viewpager.widget.ViewPager
            android:id="@+id/viewPager"
            android:layout_width="match_parent"
            android:layout_height="match_parent"
            android:layout_gravity="center"/>
</LinearLayout>
```





```java
package com.example.meta;

import android.util.Log;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import androidx.annotation.NonNull;
import androidx.appcompat.app.AppCompatActivity;
import android.os.Bundle;
import androidx.viewpager.widget.PagerAdapter;
import androidx.viewpager.widget.ViewPager;

import java.util.ArrayList;
import java.util.List;

public class Main6Activity extends AppCompatActivity {

    private List<View> viewList;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main6);

        LayoutInflater inflater =LayoutInflater.from(this);
        View view = inflater.inflate(R.layout.activity_main4, null);
        View view1 = inflater.inflate(R.layout.activity_main5, null);
        viewList = new ArrayList<>();
        viewList.add(view);
        viewList.add(view1);

        ViewPager viewPager = findViewById(R.id.viewPager);
        viewPager.setAdapter(new MyPageAdapter());
    }

    private class MyPageAdapter extends PagerAdapter{
        @Override
        public int getCount() {
            return viewList.size();
        }

        @Override
        public boolean isViewFromObject(@NonNull View view, @NonNull Object object) {
            return view==object;
        }

        @NonNull
        @Override
        public Object instantiateItem(@NonNull ViewGroup container, int position) {
            View view = viewList.get(position);
            container.addView(view);
            return view;
        }

        @Override
        public void destroyItem(@NonNull ViewGroup container, int position, @NonNull Object object) {
            Log.d("TAG","已经销毁："+viewList.get(position));
            container.removeView(viewList.get(position));
        }
    }

}
```





### ActionBar的标题设置

```java
getActionBar().setBackgroundDrawable(new ColorDrawable(0xff33bb77));

// 返回箭头（默认不显示）

getActionBar().setDisplayHomeAsUpEnabled(true);

// 左侧图标点击事件使能

getActionBar().setHomeButtonEnabled(true);

// 使左上角图标(系统)是否显示

getActionBar().setDisplayShowHomeEnabled(false);

// 显示标题

getActionBar().setDisplayShowTitleEnabled(false);

//显示自定义视图

getActionBar().setDisplayShowCustomEnabled(true);

TextView textView = new TextView(this);

textView.setText($title);

textView.setTextSize(15);

textView.setTextColor(0xffffffff);

LinearLayout actionbarLayout = new LinearLayout(this);

getActionBar().setCustomView(actionbarLayout,new ActionBar.LayoutParams(ActionBar.LayoutParams.WRAP_CONTENT,

ActionBar.LayoutParams.WRAP_CONTENT));

ActionBar.LayoutParams mP = (ActionBar.LayoutParams) actionbarLayout

.getLayoutParams();

mP.gravity = mP.gravity & ~Gravity.HORIZONTAL_GRAVITY_MASK| Gravity.CENTER_HORIZONTAL;

actionbarLayout.addView(textView);

getActionBar().setCustomView(actionbarLayout, mP);
```



更改Toolbar文字

```java
Toolbar toolbar = (Toolbar) findViewById(R.id.toolbar);
        toolbar.setTitle("");
        TextView textView=new TextView(this);
        textView.setText("主界面");
        textView.setTextSize(18);
        textView.setTextColor(Color.parseColor("#FFFFFF"));
        textView.setGravity(Gravity.CENTER);
        Toolbar.LayoutParams layoutParams=new Toolbar.LayoutParams(Toolbar.LayoutParams.WRAP_CONTENT,Toolbar.LayoutParams.WRAP_CONTENT);
        layoutParams.gravity=Gravity.CENTER;
        textView.setLayoutParams(layoutParams);
        toolbar.addView(textView);
```



### 环境指标题

 1、利用给定的资源，实现该界面原型的布局。
2、实现空气温度、空气湿度、PM2.5、CO2、光照、道路状态（默认编号为1的道路）实时数据显示功能。
注：数据实时刷新周期为3秒。
3、实现阈值报警状态警示功能，正常状态背景为绿色，超阈值警告状态为红色。
4、6个指数实时数据需要进行数据库存储，只需保存最近1分钟内的20个数据（周期为3秒）。
注意：合理处理接口并发请求问题。



###### 网络权限一定要添加

```xml
<uses-permission android:name="android.permission.INTERNET"/>
```



###### 依赖库：

```xml
implementation "com.squareup.okhttp3:okhttp:4.2.0"
```



###### 圆形背景

radio.xml

```xml
<?xml version="1.0" encoding="utf-8"?>
<shape xmlns:android="http://schemas.android.com/apk/res/android"
       android:shape="oval"
       android:useLevel="false">
    <solid android:color="#888888" />
    <stroke android:width="1dip" android:color="#000000" />
    <size
            android:width="15dp"
            android:height="15dp" />
</shape>
```



###### MainActivity.java

```java
package com.example.a11_5app;

import android.content.ContentValues;
import android.database.sqlite.SQLiteDatabase;
import android.graphics.Color;
import android.os.AsyncTask;
import android.os.CountDownTimer;
import android.util.Log;
import android.widget.RelativeLayout;
import android.widget.TextView;
import androidx.appcompat.app.AppCompatActivity;
import android.os.Bundle;
import okhttp3.*;
import org.json.JSONException;
import org.json.JSONObject;

import java.io.IOException;
import java.util.HashMap;
import java.util.Map;

public class MainActivity extends AppCompatActivity {


    private SQLiteDatabase writableDatabase;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.environment);
        MyDatabase database = new MyDatabase(this, "MyDatabase.db", null, 1);
        new MyTime(60000, 3000).start();
        writableDatabase = database.getWritableDatabase();
    }


    class MyData extends AsyncTask<Void, Void, Map> {


        @Override
        protected void onPreExecute() {
            super.onPreExecute();

        }

        @Override
        protected Map doInBackground(Void... voids) {
            Map<String, String> map = new HashMap<>();
            postData(map);
            postData1(map);
            return map;
        }

        @Override
        protected void onPostExecute(Map map) {

            ContentValues contentValues = new ContentValues();
            contentValues.put("temperature", (String) map.get("temperature"));
            contentValues.put("humidity", (String) map.get("humidity"));
            contentValues.put("LightIntensity", (String) map.get("LightIntensity"));
            contentValues.put("co2", (String) map.get("co2"));
            contentValues.put("pm", (String) map.get("pm2.5"));
            contentValues.put("Status", (String) map.get("Status"));

            writableDatabase.insert("data",null,contentValues);


            super.onPostExecute(map);

            TextView temperature = findViewById(R.id.data_temperature);
            temperature.setText(map.get("temperature") + "");
            int data1 = Integer.valueOf((String) map.get("temperature"));
            if (data1 > 32) {
                RelativeLayout layout1 = findViewById(R.id.layout1);
                layout1.setBackgroundColor(Color.parseColor("#c32136"));
            } else {
                RelativeLayout layout1 = findViewById(R.id.layout1);
                layout1.setBackgroundColor(Color.parseColor("#00bc12"));
            }

            TextView humidity = findViewById(R.id.data_humidity);
            humidity.setText(map.get("humidity") + "");
            int data2 = Integer.valueOf((String) map.get("humidity"));
            if (data2 > 80) {
                RelativeLayout layout2 = findViewById(R.id.layout2);
                layout2.setBackgroundColor(Color.parseColor("#c32136"));
            } else {
                RelativeLayout layout2 = findViewById(R.id.layout2);
                layout2.setBackgroundColor(Color.parseColor("#00bc12"));
            }

            TextView LightIntensity = findViewById(R.id.data_LightIntensity);
            LightIntensity.setText(map.get("LightIntensity") + "");
            int data3 = Integer.valueOf((String) map.get("LightIntensity"));
            if (data3 > 567) {
                RelativeLayout layout3 = findViewById(R.id.layout3);
                layout3.setBackgroundColor(Color.parseColor("#c32136"));
            } else {
                RelativeLayout layout3 = findViewById(R.id.layout3);
                layout3.setBackgroundColor(Color.parseColor("#00bc12"));
            }

            TextView co2 = findViewById(R.id.data_co);
            co2.setText(map.get("co2") + "");
            int data4 = Integer.valueOf((String) map.get("co2"));
            if (data4 > 324) {
                RelativeLayout layout4 = findViewById(R.id.layout4);
                layout4.setBackgroundColor(Color.parseColor("#c32136"));
            } else {
                RelativeLayout layout4 = findViewById(R.id.layout4);
                layout4.setBackgroundColor(Color.parseColor("#00bc12"));
            }

            TextView PM = findViewById(R.id.data_PM2_5);
            PM.setText(map.get("pm2.5") + "");
            int data5 = Integer.valueOf((String) map.get("pm2.5"));
            if (data5 > 254) {
                RelativeLayout layout5 = findViewById(R.id.layout5);
                layout5.setBackgroundColor(Color.parseColor("#c32136"));
            } else {
                RelativeLayout layout5 = findViewById(R.id.layout5);
                layout5.setBackgroundColor(Color.parseColor("#00bc12"));
            }

            TextView Status = findViewById(R.id.data_state);
            Status.setText(map.get("Status") + "");
            int data6 = Integer.valueOf((String) map.get("Status"));
            if (data6 > 4) {
                RelativeLayout layout6 = findViewById(R.id.layout6);
                layout6.setBackgroundColor(Color.parseColor("#c32136"));
            } else {
                RelativeLayout layout6 = findViewById(R.id.layout6);
                layout6.setBackgroundColor(Color.parseColor("#00bc12"));
            }


        }
    }

    private void postData(Map<String, String> map) {


        try {
            OkHttpClient client = new OkHttpClient();

            RequestBody requestBody = FormBody.create(MediaType.parse("application/json; charset=utf-8"), "{\"UserName\":\"user1\"}");
            Request request = new Request.Builder()
                    .url("http://192.168.1.101:8088/transportservice/action/GetAllSense.do")//请求的url
                    .post(requestBody)
                    .build();

            Response response = client.newCall(request).execute();

            JSONObject object = new JSONObject(response.body().string());
            Log.d("TAG", "postData: " + object.toString());
            map.put("pm2.5", object.getString("pm2.5"));
            map.put("co2", object.getString("co2"));
            map.put("LightIntensity", object.getString("LightIntensity"));
            map.put("humidity", object.getString("humidity"));
            map.put("temperature", object.getString("temperature"));
        } catch (IOException e) {
            e.printStackTrace();
        } catch (JSONException e) {
            e.printStackTrace();
        }
    }

    private void postData1(Map<String, String> map) {
        try {
            OkHttpClient client = new OkHttpClient();

            RequestBody requestBody = FormBody.create(MediaType.parse("application/json; charset=utf-8"), "{\"RoadId\":1,\"UserName\":\"user1\"}");
            Request request = new Request.Builder()
                    .url("http://192.168.1.101:8088/transportservice/action/GetRoadStatus.do")//请求的url
                    .post(requestBody)
                    .build();

            Response response = client.newCall(request).execute();

            JSONObject object = new JSONObject(response.body().string());
            Log.d("TAG", "postData1: " + object.toString());
            map.put("Status", object.getString("Status"));
        } catch (IOException e) {
            e.printStackTrace();
        } catch (JSONException e) {
            e.printStackTrace();
        }
    }

    class MyTime extends CountDownTimer {

        public MyTime(long millisInFuture, long countDownInterval) {
            super(millisInFuture, countDownInterval);
        }

        @Override
        public void onTick(long millisUntilFinished) {
            new MyData().execute();
        }

        @Override
        public void onFinish() {
            cancel();
        }
    }


}
```



###### MyDatabase.java

```java
package com.example.a11_5app;/*
 * Created by crazymen.
 */

import android.content.Context;
import android.database.sqlite.SQLiteDatabase;
import android.database.sqlite.SQLiteOpenHelper;

public class MyDatabase extends SQLiteOpenHelper {
    public MyDatabase(Context context, String name, SQLiteDatabase.CursorFactory factory, int version) {
        super(context, name, factory, version);
    }

    @Override
    public void onCreate(SQLiteDatabase db) {
        db.execSQL("create table data(" +
                "id Integer primary key autoincrement," +
                "temperature text," +
                "humidity text," +
                "LightIntensity text," +
                "co2 text," +
                "pm text," +
                "Status text)");
    }

    @Override
    public void onUpgrade(SQLiteDatabase db, int oldVersion, int newVersion) {

    }
}

```





###### environment.xml

```xml
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
              android:orientation="vertical"
              android:layout_width="match_parent"
              android:layout_height="match_parent">
    <LinearLayout
            android:layout_width="match_parent"
            android:layout_height="200dp"
            android:orientation="horizontal">

        <LinearLayout
                android:layout_width="match_parent"
                android:layout_height="200dp"
                android:orientation="horizontal">
            <RelativeLayout
                    android:id="@+id/layout1"
                    android:layout_width="0dp"
                    android:background="#00bc12"
                    android:layout_margin="10dp"
                    android:layout_height="180dp"
                    android:layout_weight="1"
                    android:orientation="vertical"
                    xmlns:android="http://schemas.android.com/apk/res/android">
                <TextView android:id="@+id/temperature"
                          android:layout_width="wrap_content"
                          android:layout_height="wrap_content"
                          android:layout_margin="20dp"
                          android:textSize="30sp"
                          android:text="温度"/>
                <TextView
                        android:id="@+id/data_temperature"
                        android:layout_width="60dp"
                        android:layout_height="60dp"
                        android:gravity="center_vertical|center_horizontal"
                        android:textSize="25sp"
                        android:background="@drawable/radio"
                        android:layout_below="@+id/temperature"
                        android:layout_alignParentRight="true"
                        android:layout_margin="10dp"
                        android:layout_marginLeft="165dp"/>
            </RelativeLayout>
            <RelativeLayout
                    android:id="@+id/layout2"
                    android:background="#00bc12"
                    android:layout_width="0dp"
                    android:layout_margin="10dp"
                    android:layout_height="180dp"
                    android:layout_weight="1"
                    android:orientation="vertical">
                <TextView android:id="@+id/humidity"
                          android:layout_width="wrap_content"
                          android:layout_height="wrap_content"
                          android:layout_margin="20dp"
                          android:textSize="30sp"
                          android:text="湿度"/>
                <TextView
                        android:id="@+id/data_humidity"
                        android:layout_width="60dp"
                        android:layout_height="60dp"
                        android:gravity="center_vertical|center_horizontal"
                        android:textSize="25sp"
                        android:background="@drawable/radio"
                        android:layout_below="@id/humidity"
                        android:layout_alignParentRight="true"
                        android:layout_margin="10dp"
                        android:layout_marginLeft="165dp"/>
            </RelativeLayout>
            <RelativeLayout
                    android:id="@+id/layout3"
                    android:background="#00bc12"
                    android:layout_width="0dp"
                    android:layout_margin="10dp"
                    android:layout_height="180dp"
                    android:layout_weight="1"
                    android:orientation="vertical">
                <TextView android:id="@+id/LightIntensity"
                          android:layout_width="wrap_content"
                          android:layout_height="wrap_content"
                          android:layout_margin="20dp"
                          android:textSize="30sp"
                          android:text="光照"/>
                <TextView
                        android:id="@+id/data_LightIntensity"
                        android:layout_width="60dp"
                        android:layout_height="60dp"
                        android:gravity="center_vertical|center_horizontal"
                        android:textSize="25sp"
                        android:background="@drawable/radio"
                        android:layout_below="@+id/LightIntensity"
                        android:layout_alignParentRight="true"
                        android:layout_margin="10dp"
                        android:layout_marginLeft="165dp"/>
            </RelativeLayout>

        </LinearLayout>
    </LinearLayout>
    <LinearLayout
            android:layout_width="match_parent"
            android:layout_height="200dp"
            android:orientation="horizontal">
        <RelativeLayout
                android:id="@+id/layout4"
                android:background="#00bc12"
                android:layout_width="0dp"
                android:layout_margin="10dp"
                android:layout_height="180dp"
                android:layout_weight="1"
                android:orientation="vertical">
            <TextView android:id="@+id/co"
                      android:layout_width="wrap_content"
                      android:layout_height="wrap_content"
                      android:layout_margin="20dp"
                      android:textSize="30sp"
                      android:text="co2"/>
            <TextView
                    android:id="@+id/data_co"
                    android:layout_width="60dp"
                    android:layout_height="60dp"
                    android:gravity="center_vertical|center_horizontal"
                    android:textSize="25sp"
                    android:background="@drawable/radio"
                    android:layout_below="@+id/co"
                    android:layout_alignParentRight="true"
                    android:layout_margin="10dp"
                    android:layout_marginLeft="165dp"/>
        </RelativeLayout>
        <RelativeLayout
                android:id="@+id/layout5"
                android:background="#00bc12"
                android:layout_width="0dp"
                android:layout_margin="10dp"
                android:layout_height="180dp"
                android:layout_weight="1"
                android:orientation="vertical">
            <TextView android:id="@+id/PM2.5"
                      android:layout_width="wrap_content"
                      android:layout_height="wrap_content"
                      android:layout_margin="20dp"
                      android:textSize="30sp"
                      android:text="PM2.5"/>
            <TextView
                    android:id="@+id/data_PM2.5"
                    android:layout_width="60dp"
                    android:layout_height="60dp"
                    android:gravity="center_vertical|center_horizontal"
                    android:textSize="25sp"
                    android:background="@drawable/radio"
                    android:layout_below="@+id/PM2.5"
                    android:layout_alignParentRight="true"
                    android:layout_margin="10dp"
                    android:layout_marginLeft="165dp"/>
        </RelativeLayout>
        <RelativeLayout
                android:id="@+id/layout6"
                android:background="#c32136"
                android:layout_width="0dp"
                android:layout_margin="10dp"
                android:layout_height="180dp"
                android:layout_weight="1"
                android:orientation="vertical">
            <TextView android:id="@+id/state"
                      android:layout_width="wrap_content"
                      android:layout_height="wrap_content"
                      android:layout_margin="20dp"
                      android:textSize="30sp"
                      android:text="道路状态"/>
            <TextView
                    android:id="@+id/data_state"
                    android:layout_width="60dp"
                    android:layout_height="60dp"
                    android:gravity="center_vertical|center_horizontal"
                    android:textSize="25sp"
                    android:background="@drawable/radio"
                    android:layout_below="@+id/state"
                    android:layout_alignParentRight="true"
                    android:layout_margin="10dp"
                    android:layout_marginLeft="165dp"/>
        </RelativeLayout>

    </LinearLayout>

</LinearLayout>
```





![image-20191106111919485](https://zl.crazymen.cn/images/image-20191106111919485.png)



### 公交查询



###### FragmentTabHostActivity.java

```java
package com.example.meta.question6;

import android.os.Bundle;
import android.view.View;
import android.widget.TabHost;
import android.widget.TextView;

import androidx.appcompat.app.AppCompatActivity;
import androidx.fragment.app.FragmentTabHost;
import com.example.meta.R;

public class FragmentTabHostActivity extends AppCompatActivity {
    FragmentTabHost fragmentTabHost;
    //加载的Fragment
    private Class<?> mFragmentClasses[] = {Fragment1.class, Fragment2.class};
    //标签文字
    private String[] text = new String[]{"一号站台", "二号站台"};

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_fragment_tab_host);
        fragmentTabHost = findViewById(android.R.id.tabhost);
        //初始化
        fragmentTabHost.setup(this, getSupportFragmentManager(), android.R.id.tabcontent);
        fragmentTabHost.getTabWidget().setDividerDrawable(null); // 去掉分割线
        //添加标签
        for (int i = 0; i < text.length; i++) {
            // Tab按钮添加文字
            TabHost.TabSpec tabSpec = fragmentTabHost.newTabSpec(i + "").setIndicator(getIndicatorView(i));
            // 添加Fragment
            fragmentTabHost.addTab(tabSpec, mFragmentClasses[i], null);
        }
        fragmentTabHost.setOnTabChangedListener(new TabHost.OnTabChangeListener() {
            @Override
            public void onTabChanged(String tabId) {
                //切换标签时调用
                System.out.println(tabId);
            }
        });
    }

    //获取标签的View
    private View getIndicatorView(int i) {
        View view = View.inflate(this,
                R.layout.layout_indicator_view, null);
        TextView tvTag = view.findViewById(R.id.tv_tab);
        tvTag.setText(text[i]);
        return view;
    }
}

```



###### activity_fragment_tab_host.xml

```xml
<?xml version="1.0" encoding="utf-8"?>

<androidx.fragment.app.FragmentTabHost
        xmlns:android="http://schemas.android.com/apk/res/android"
        android:id="@android:id/tabhost"
        android:layout_width="match_parent"
        android:layout_height="match_parent">
    <LinearLayout
            android:layout_width="match_parent"
            android:layout_height="match_parent"
            android:orientation="vertical">
        <!--用来加载Fragment -->
        <FrameLayout
                android:id="@android:id/tabcontent"
                android:layout_width="match_parent"
                android:layout_height="0dp"
                android:layout_weight="1"/>
        <!--分割线 用来分割Fragment和底部标签-->
        <View
                android:layout_width="match_parent"
                android:layout_height="1px"
                android:background="#d9d9d9"
                android:orientation="vertical"/>
        <!--标签组件-->
        <TabWidget
                android:id="@android:id/tabs"
                android:layout_width="match_parent"
                android:layout_height="?attr/actionBarSize"
                android:layout_gravity="bottom"/>
    </LinearLayout>

</androidx.fragment.app.FragmentTabHost>
```



###### Fragment1.java

```java
package com.example.meta.question6;


import android.os.AsyncTask;
import android.os.Bundle;
import android.os.CountDownTimer;
import android.util.Log;
import android.widget.TextView;
import androidx.annotation.Nullable;
import androidx.fragment.app.Fragment;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import com.example.meta.R;
import okhttp3.*;
import org.json.JSONArray;
import org.json.JSONException;
import org.json.JSONObject;

import java.io.IOException;
import java.util.HashMap;
import java.util.Map;


/**
 * A simple {@link Fragment} subclass.
 */
public class Fragment1 extends Fragment {


    private TextView distance1;
    private TextView distance2;
    private TextView pm2_5;
    private TextView humidity;


    public Fragment1() {
    }


    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container,
                             Bundle savedInstanceState) {
        View view = inflater.inflate(R.layout.fragment_fragment1, container, false);
        distance1 = view.findViewById(R.id.tv1_Distance1);
        distance2 = view.findViewById(R.id.tv1_Distance2);
        pm2_5 = view.findViewById(R.id.tv1_PM2_5);
        humidity = view.findViewById(R.id.tv1_humidity);
        return view;
    }

    @Override
    public void onActivityCreated(@Nullable Bundle savedInstanceState) {
        super.onActivityCreated(savedInstanceState);
        new MyTime(60000, 5000).start();
    }

    class MyTask extends AsyncTask<Void, Void, Map<String, Object>> {

        private Map<String, Object> data = new HashMap<>();

        @Override
        protected Map<String, Object> doInBackground(Void... voids) {
            try {
                JSONObject object = new JSONObject(post("http://192.168.1.101:8088/transportservice/action/GetBusStationInfo.do", "{\"BusStationId\":1,\"UserName\":\"user1\"}"));
                JSONArray array = new JSONArray(object.getString("ROWS_DETAIL"));
                for (int i = 0; i < array.length(); i++) {
                    JSONObject object1 = array.getJSONObject(i);
                    data.put("Distance" + (i + 1), object1.getString("Distance"));
                }
                JSONObject object1 = new JSONObject(post("http://192.168.1.101:8088/transportservice/action/GetAllSense.do", "{\"UserName\":\"user1\"}"));
                data.put("pm2.5", object1.getString("pm2.5"));
                data.put("temperature", object1.getString("temperature"));
                data.put("humidity", object1.getString("humidity"));
                data.put("co2", object1.getString("co2"));
            } catch (IOException e) {
                e.printStackTrace();
            } catch (JSONException e) {
                e.printStackTrace();
            }
            Log.d("data", "doInBackground: " + data.toString());
            return data;
        }

        @Override
        protected void onPostExecute(Map<String, Object> stringObjectMap) {
            super.onPostExecute(stringObjectMap);
            distance1.setText("一号公交车：" + stringObjectMap.get("Distance1") + "m");
            distance2.setText("二号公交车：" + stringObjectMap.get("Distance2") + "m");
            pm2_5.setText("PM2.5：" + stringObjectMap.get("pm2.5") + "μg/m³，温度：" + stringObjectMap.get("temperature") + "°C");
            humidity.setText("湿度：" + stringObjectMap.get("humidity") + "%，CO2：" + stringObjectMap.get("co2") + "PPM");
        }
    }


    //    使用okhttp发送一个post请求,接收一个地址参数和一个Json类型的参数
    public static String post(String address, String json) throws IOException {
        OkHttpClient client = new OkHttpClient();

        RequestBody requestBody = FormBody.create(MediaType.parse("application/json; charset=utf-8"), json);
        Request request = new Request.Builder()
                .url(address)//请求的url
                .post(requestBody)
                .build();
        return client.newCall(request).execute().body().string();
    }

    class MyTime extends CountDownTimer {
        public MyTime(long millisInFuture, long countDownInterval) {
            super(millisInFuture, countDownInterval);
        }

        @Override
        public void onTick(long millisUntilFinished) {
            new MyTask().execute();
        }

        @Override
        public void onFinish() {
            cancel();
        }
    }
}

```



###### fragment_fragment1.xml

```xml
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
              xmlns:tools="http://schemas.android.com/tools"
              android:layout_width="match_parent"
              android:layout_height="match_parent"
              android:orientation="vertical"
              android:layout_marginLeft="150dp"
              android:layout_marginTop="50dp"
              tools:context=".question6.Fragment1">

    <TextView
            android:layout_width="match_parent"
            android:layout_height="50dp"
            android:text="距一号站台距离："
            android:textColor="#000000"
            android:textStyle="bold"
            android:textSize="25sp"/>
    <TextView
            android:id="@+id/tv1_Distance1"
            android:layout_width="match_parent"
            android:layout_height="50dp"
            android:textColor="#000000"
            android:layout_marginLeft="20dp"
            android:text="一号公交车："
            android:textSize="20sp"/>
    <TextView
            android:id="@+id/tv1_Distance2"
            android:layout_width="match_parent"
            android:layout_height="50dp"
            android:textColor="#000000"
            android:layout_marginLeft="20dp"
            android:text="二号公交车："
            android:textSize="20sp"/>
    <TextView
            android:layout_width="match_parent"
            android:layout_height="50dp"
            android:text="候车环境："
            android:textColor="#000000"
            android:textStyle="bold"
            android:textSize="25sp"/>
    <TextView
            android:layout_width="match_parent"
            android:layout_height="50dp"
            android:textColor="#000000"
            android:layout_marginLeft="20dp"
            android:text="道路环境："
            android:textSize="20sp"/>
    <TextView
            android:id="@+id/tv1_PM2.5"
            android:layout_width="match_parent"
            android:layout_height="50dp"
            android:textColor="#000000"
            android:layout_marginLeft="20dp"
            android:text="PM2_5："
            android:textSize="20sp"/>
    <TextView
            android:id="@+id/tv1_humidity"
            android:layout_width="match_parent"
            android:layout_height="50dp"
            android:textColor="#000000"
            android:layout_marginLeft="20dp"
            android:text="湿度："
            android:textSize="20sp"/>


</LinearLayout>
```



###### Fragment2.java

```jav
package com.example.meta.question6;


import android.os.AsyncTask;
        import android.os.Bundle;
        import android.os.CountDownTimer;
        import android.util.Log;
        import android.widget.TextView;
        import androidx.annotation.Nullable;
        import androidx.fragment.app.Fragment;
        import android.view.LayoutInflater;
        import android.view.View;
        import android.view.ViewGroup;
import com.example.meta.R;
import okhttp3.*;
        import org.json.JSONArray;
        import org.json.JSONException;
        import org.json.JSONObject;

        import java.io.IOException;
        import java.util.HashMap;
        import java.util.Map;


/**
 * A simple {@link Fragment} subclass.
 */
public class Fragment2 extends Fragment {

    private TextView distance1;
    private TextView distance2;
    private TextView pm2_5;
    private TextView humidity;

    public Fragment2() {
        // Required empty public constructor
    }


    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container,
                             Bundle savedInstanceState) {
        View view = inflater.inflate(R.layout.fragment_fragment2, container, false);
        distance1 = view.findViewById(R.id.tv2_Distance1);
        distance2 = view.findViewById(R.id.tv2_Distance2);
        pm2_5 = view.findViewById(R.id.tv2_PM2_5);
        humidity = view.findViewById(R.id.tv2_humidity);
        return view;
    }

    @Override
    public void onActivityCreated(@Nullable Bundle savedInstanceState) {
        super.onActivityCreated(savedInstanceState);
        new MyTime(60000,5000).start();
    }

    class MyTask extends AsyncTask<Void, Void, Map<String, Object>> {

        private Map<String, Object> data = new HashMap<>();

        @Override
        protected Map<String, Object> doInBackground(Void... voids) {
            try {
                JSONObject object = new JSONObject(post("http://192.168.1.101:8088/transportservice/action/GetBusStationInfo.do", "{\"BusStationId\":2,\"UserName\":\"user1\"}"));
                JSONArray array = new JSONArray(object.getString("ROWS_DETAIL"));
                for (int i = 0; i < array.length(); i++) {
                    JSONObject object1 = array.getJSONObject(i);
                    data.put("Distance" + (i + 1), object1.getString("Distance"));
                }
                JSONObject object1 = new JSONObject(post("http://192.168.1.101:8088/transportservice/action/GetAllSense.do", "{\"UserName\":\"user1\"}"));
                data.put("pm2.5", object1.getString("pm2.5"));
                data.put("temperature", object1.getString("temperature"));
                data.put("humidity", object1.getString("humidity"));
                data.put("co2", object1.getString("co2"));
            } catch (IOException e) {
                e.printStackTrace();
            } catch (JSONException e) {
                e.printStackTrace();
            }
            Log.d("data", "doInBackground: " + data.toString());
            return data;
        }

        @Override
        protected void onPostExecute(Map<String, Object> stringObjectMap) {
            super.onPostExecute(stringObjectMap);
            distance1.setText("一号公交车：" + stringObjectMap.get("Distance1") + "m");
            distance2.setText("二号公交车：" + stringObjectMap.get("Distance2") + "m");
            pm2_5.setText("PM2.5：" + stringObjectMap.get("pm2.5") + "μg/m³，温度：" + stringObjectMap.get("temperature") + "°C");
            humidity.setText("湿度：" + stringObjectMap.get("humidity") + "%，CO2：" + stringObjectMap.get("co2") + "PPM");
        }
    }


    //    使用okhttp发送一个post请求,接收一个地址参数和一个Json类型的参数
    public static String post(String address, String json) throws IOException {
        OkHttpClient client = new OkHttpClient();

        RequestBody requestBody = FormBody.create(MediaType.parse("application/json; charset=utf-8"), json);
        Request request = new Request.Builder()
                .url(address)//请求的url
                .post(requestBody)
                .build();
        return client.newCall(request).execute().body().string();
    }

    class MyTime extends CountDownTimer {
        public MyTime(long millisInFuture, long countDownInterval) {
            super(millisInFuture, countDownInterval);
        }

        @Override
        public void onTick(long millisUntilFinished) {
            new MyTask().execute();
        }

        @Override
        public void onFinish() {
            cancel();
        }
    }
}

```



###### fragment_fragment2.xml

```xml
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
              xmlns:tools="http://schemas.android.com/tools"
              android:layout_width="match_parent"
              android:layout_height="match_parent"
              android:orientation="vertical"
              android:layout_marginLeft="150dp"
              android:layout_marginTop="50dp"
              tools:context=".question6.Fragment1">

    <TextView
            android:layout_width="match_parent"
            android:layout_height="50dp"
            android:text="距二号站台距离："
            android:textColor="#000000"
            android:textStyle="bold"
            android:textSize="25sp"/>
    <TextView
            android:id="@+id/tv2_Distance1"
            android:layout_width="match_parent"
            android:layout_height="50dp"
            android:textColor="#000000"
            android:layout_marginLeft="20dp"
            android:text="一号公交车："
            android:textSize="20sp"/>
    <TextView
            android:id="@+id/tv2_Distance2"
            android:layout_width="match_parent"
            android:layout_height="50dp"
            android:textColor="#000000"
            android:layout_marginLeft="20dp"
            android:text="二号公交车："
            android:textSize="20sp"/>
    <TextView
            android:layout_width="match_parent"
            android:layout_height="50dp"
            android:text="候车环境："
            android:textColor="#000000"
            android:textStyle="bold"
            android:textSize="25sp"/>
    <TextView
            android:layout_width="match_parent"
            android:layout_height="50dp"
            android:textColor="#000000"
            android:layout_marginLeft="20dp"
            android:text="道路环境："
            android:textSize="20sp"/>
    <TextView
            android:id="@+id/tv2_PM2_5"
            android:layout_width="match_parent"
            android:layout_height="50dp"
            android:textColor="#000000"
            android:layout_marginLeft="20dp"
            android:text="PM2.5："
            android:textSize="20sp"/>
    <TextView
            android:id="@+id/tv2_humidity"
            android:layout_width="match_parent"
            android:layout_height="50dp"
            android:textColor="#000000"
            android:layout_marginLeft="20dp"
            android:text="湿度："
            android:textSize="20sp"/>


</LinearLayout>
```



子项标题栏的布局文件

###### layout_indicator_view.xml

```xml
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout
        xmlns:android="http://schemas.android.com/apk/res/android"
        android:layout_width="match_parent"
        android:layout_height="match_parent"
        android:gravity="center"
        android:orientation="vertical">

    <TextView
            android:id="@+id/tv_tab"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:text="标签"/>
</LinearLayout>
```



![image-20191108202615206](https://zl.crazymen.cn/images/image-20191108202615206.png)





### 旅行助手

购买按钮的边框

###### textview_border.xml

```xml
<?xml version="1.0" encoding="utf-8"?>
<shape xmlns:android="http://schemas.android.com/apk/res/android">


    <!-- 设置一个黑色边框 -->
    <stroke
            android:width="10px"
            android:color="@color/colorAccent" />
    <!-- 设置四个圆角的半径 -->
    <corners
            android:bottomLeftRadius="40px"
            android:bottomRightRadius="40px"
            android:topLeftRadius="40px"
            android:topRightRadius="40px" />
    <!-- 设置一下边距,让空间大一点 -->
    <padding
            android:bottom="5dp"
            android:left="5dp"
            android:right="5dp"
            android:top="5dp" />

</shape>

```



RecyclerView的子项布局

###### question8item.xml

```xml
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
              android:orientation="horizontal"
              android:layout_width="match_parent"
              android:layout_height="match_parent">
    <ImageView
            android:id="@+id/image"
            android:layout_width="300dp"
            android:layout_height="200dp"
            android:layout_margin="20dp"
            android:scaleType="centerCrop"
    />
    <LinearLayout
            android:layout_width="match_parent"
            android:layout_marginTop="20dp"
            android:layout_height="match_parent"
            android:orientation="vertical">
        <TextView
                android:id="@+id/name"
                android:text="故宫"
                android:textColor="#000"
                android:textSize="35sp"
                android:layout_width="wrap_content"
                android:layout_height="80dp"/>
        <TextView
                android:id="@+id/buy"
                android:background="@drawable/textview_border"
                android:text="购买"
                android:textColor="@color/colorAccent"
                android:textSize="25sp"
                android:textStyle="bold"
                android:layout_width="130dp"
                android:gravity="center"
                android:layout_height="wrap_content"/>
        <TextView
                android:id="@+id/ticket"
                android:text="票价￥80"
               android:layout_marginTop="30dp"
                android:textColor="#000"
                android:textSize="33sp"
                android:layout_width="wrap_content"
                android:layout_height="100dp"/>
    </LinearLayout>
</LinearLayout>
```



###### Main7Activity.java

```java
package com.example.meta.question8;

import android.util.Log;
import android.view.View;
import android.view.ViewGroup;
import android.widget.ImageView;
import android.widget.TextView;
import androidx.annotation.NonNull;
import androidx.appcompat.app.AppCompatActivity;
import android.os.Bundle;
import androidx.recyclerview.widget.RecyclerView;
import androidx.recyclerview.widget.StaggeredGridLayoutManager;
import com.bumptech.glide.Glide;
import com.example.meta.R;
import okhttp3.*;
import org.json.JSONArray;
import org.json.JSONException;
import org.json.JSONObject;

import java.io.IOException;
import java.util.HashMap;
import java.util.Map;

public class Main7Activity extends AppCompatActivity {

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main7);

        RecyclerView recyclerView = findViewById(R.id.recyclerView);

        //实例化瀑布流布局管理器
        StaggeredGridLayoutManager layoutManager = new StaggeredGridLayoutManager(2, StaggeredGridLayoutManager.VERTICAL);

        //设置recyclerView的布局管理器
        recyclerView.setLayoutManager(layoutManager);

        MyAdapter adapter = new MyAdapter();
        recyclerView.setAdapter(adapter);

    }

    class MyAdapter extends RecyclerView.Adapter<MyAdapter.ViewHolder> {
        @NonNull
        @Override
        public ViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {
            View view = View.inflate(getApplicationContext(), R.layout.question8item, null);
            ViewHolder viewHolder = new ViewHolder(view);
            return viewHolder;
        }

        @Override
        public void onBindViewHolder(@NonNull final ViewHolder holder, int position) {

            new Thread(new Runnable() {
                Map<String, Object> data = new HashMap<>();

                @Override
                public void run() {
                    try {
                        JSONObject object = new JSONObject(post("http://192.168.1.101:8088/transportservice/action/GetSpotInfo.do", "{\"UserName\":\"user1\"}"));
                        JSONArray array = new JSONArray(object.getString("ROWS_DETAIL"));
                        for (int i = 0; i < array.length(); i++) {
                            JSONObject object1 = array.getJSONObject(i);
                            data.put("name", object1.getString("name"));
                            data.put("ticket", object1.getString("ticket"));
                            data.put("img", "http://192.168.1.101:8088/transportservice" + object1.getString("img"));
                        }

                        Log.d("TAG", "run: " + data.toString());
                        runOnUiThread(new Runnable() {
                            @Override
                            public void run() {
                                holder.name.setText(data.get("name") + "");
                                holder.ticket.setText("票价￥" + data.get("ticket"));
                                Glide.with(getApplicationContext()).load(data.get("img")).into(holder.image);
                            }
                        });

                    } catch (IOException e) {
                        e.printStackTrace();
                    } catch (JSONException e) {
                        e.printStackTrace();
                    }
                }
            }).start();
        }

        @Override
        public int getItemCount() {
            return 6;
        }

        class ViewHolder extends RecyclerView.ViewHolder {

            ImageView image;
            TextView name;
            TextView ticket;

            public ViewHolder(@NonNull View itemView) {
                super(itemView);
                image = itemView.findViewById(R.id.image);
                name = itemView.findViewById(R.id.name);
                ticket = itemView.findViewById(R.id.ticket);
            }
        }

    }

    //    使用okhttp发送一个post请求,接收一个地址参数和一个Json类型的参数
    public static String post(String address, String json) throws IOException {
        OkHttpClient client = new OkHttpClient();

        RequestBody requestBody = FormBody.create(MediaType.parse("application/json; charset=utf-8"), json);
        Request request = new Request.Builder()
                .url(address)//请求的url
                .post(requestBody)
                .build();
        return client.newCall(request).execute().body().string();
    }

}

```



###### activity_main8.xml

```xml
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout
        xmlns:android="http://schemas.android.com/apk/res/android"
        xmlns:tools="http://schemas.android.com/tools"
        android:layout_width="match_parent"
        android:layout_height="match_parent"
        android:orientation="vertical"
        tools:context=".question8.Main8Activity">
    <TextView
            android:text="向商家付款："
            android:textStyle="bold"
            android:textColor="#000"
            android:layout_marginLeft="10dp"
            android:textSize="45sp"
            android:layout_width="match_parent"
            android:layout_height="60dp"/>
    <View
            android:layout_width="match_parent"
            android:layout_height="2dp"
            android:background="#888"
            android:layout_marginRight="15dp"

    />
    <TextView
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:textSize="35sp"
            android:textColor="#000"
            android:gravity="center"
            android:text="付款项目：故宫  付款金额：80元"/>

    <ImageView
            android:layout_gravity="center_horizontal"
            android:layout_width="300dp"
            android:src="@drawable/erweima"
            android:layout_height="300dp"/>
</LinearLayout>
```



###### Main8Activity.java

```java
package com.example.meta.question8;

import androidx.appcompat.app.AppCompatActivity;
import android.os.Bundle;
import com.example.meta.R;

public class Main8Activity extends AppCompatActivity {

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main8);
    }
}

```

![image-20191109090804846](https://zl.crazymen.cn/images/image-20191109090804846.png)



### 实时交通：

###### Main9Activity.java

```java
package com.example.meta.question7;

import android.content.Intent;
import android.view.View;
import android.view.ViewGroup;
import android.widget.*;
import androidx.annotation.Nullable;
import androidx.appcompat.app.AppCompatActivity;
import android.os.Bundle;
import com.example.meta.R;

import java.util.ArrayList;
import java.util.List;

public class Main9Activity extends AppCompatActivity implements View.OnClickListener {

    private EditText inf;
    private Button search;
    private Button clear;
    private ListView listView;
    List<String> item = new ArrayList<>();
    private MyAdapter myAdapter;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main9);
        initView();


    }

    private void initView() {
        inf = findViewById(R.id.inf);
        search = findViewById(R.id.search);
        clear = findViewById(R.id.clear);
        listView = findViewById(R.id.listView);
        search.setOnClickListener(this);
        clear.setOnClickListener(this);
    }

    @Override
    public void onClick(View v) {
        switch (v.getId()) {
            case R.id.search: {
                if (String.valueOf(inf.getText()).equals("")) {
                    Toast.makeText(getApplicationContext(), "请输入要查询的信息！", Toast.LENGTH_SHORT).show();
                } else {
                    if (String.valueOf(inf.getText()).equals("1") || String.valueOf(inf.getText()).equals("2") || String.valueOf(inf.getText()).equals("3") || String.valueOf(inf.getText()).equals("4") || String.valueOf(inf.getText()).equals("5") || String.valueOf(inf.getText()).equals("6") || String.valueOf(inf.getText()).equals("7") || String.valueOf(inf.getText()).equals("8") || String.valueOf(inf.getText()).equals("9") || String.valueOf(inf.getText()).equals("10")) {
                        Intent intent = new Intent(Main9Activity.this, Main10Activity.class);
                        intent.putExtra("Id", String.valueOf(inf.getText()));
                        startActivityForResult(intent, 1);
                    } else Toast.makeText(getApplicationContext(), "请输入需要查询的公交车号码！", Toast.LENGTH_SHORT).show();

                }
            }
            break;
            case R.id.clear: {

                if (item.size() > 0) {
                    item.clear();
                    myAdapter.notifyDataSetChanged();
                    listView.setAdapter(myAdapter);
                } else {
                    Toast.makeText(this, "无历史记录！", Toast.LENGTH_SHORT).show();
                }
                break;
            }
            default:
                break;
        }

    }

    @Override
    protected void onActivityResult(int requestCode, int resultCode, @Nullable Intent data) {
        super.onActivityResult(requestCode, resultCode, data);
        switch (requestCode) {
            case 1: {
                if (resultCode == RESULT_OK) {
                    item.add(inf.getText() + "路" + "(" + data.getStringExtra("item") + ")");
                    myAdapter = new MyAdapter();
                    listView.setAdapter(myAdapter);
                }
            }
        }
    }

    class MyAdapter extends BaseAdapter {

        private View view;
        private ViewHolder viewHolder;

        @Override
        public int getCount() {
            return item.size();
        }

        @Override
        public Object getItem(int position) {
            return item.size();
        }

        @Override
        public long getItemId(int position) {
            return item.size();
        }

        @Override
        public View getView(int position, View convertView, ViewGroup parent) {
            if (convertView == null) {
                view = View.inflate(getApplicationContext(), R.layout.question7item, null);
                viewHolder = new ViewHolder();
                viewHolder.info = view.findViewById(R.id.history);
                view.setTag(viewHolder);
            } else {
                view = convertView;
                viewHolder = (ViewHolder) view.getTag();
            }
            viewHolder.info.setText(item.get(position));
            return view;
        }
    }

    class ViewHolder {
        TextView info;
    }

}


```



###### activity_main9.xml

```xml
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout
        xmlns:android="http://schemas.android.com/apk/res/android"
        android:layout_width="match_parent"
        android:orientation="vertical"
        android:layout_height="match_parent"
        >
    <LinearLayout
            android:layout_width="500dp"
            android:background="#888"
            android:layout_marginTop="100dp"
            android:layout_gravity="center_horizontal"
            android:layout_height="60dp">
        <ImageView
                android:layout_marginLeft="25dp"
                android:layout_gravity="center_vertical"
                android:background="@drawable/search"
                android:layout_width="32dp"
                android:layout_height="32dp"/>
        <EditText
                android:layout_marginLeft="5dp"
                android:id="@+id/inf"
                android:layout_width="200dp"
                android:background="@null"
                android:layout_gravity="center_vertical"
                android:hint="请输入公交车线路号"
                android:maxLines="1"
                android:textSize="18sp"
                android:layout_height="40dp"/>
        <Button
                android:id="@+id/search"
                android:background="@drawable/radio"
                android:layout_width="50dp"
               android:layout_marginLeft="180dp"
                android:text="搜索"
                android:layout_gravity="center_vertical"
                android:textSize="16sp"
                android:gravity="center_vertical|center_horizontal"
                android:layout_height="50dp"/>

    </LinearLayout>

    <TextView
            android:layout_marginRight="200dp"
            android:layout_marginTop="20dp"
            android:textSize="18sp"
            android:layout_gravity="center_horizontal"
            android:text="搜索历史"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"/>
    <View
            android:layout_marginTop="5dp"
            android:layout_gravity="center_horizontal"
            android:background="#000"
            android:layout_width="500dp"
            android:layout_height="0.5dp"/>
    <ListView
            android:id="@+id/listView"
            android:layout_gravity="center_horizontal"
            android:layout_width="500dp"
            android:layout_height="100dp"/>

    <View
            android:layout_gravity="center_horizontal"
            android:background="#000"
            android:layout_width="500dp"
            android:layout_height="0.5dp"/>
    <Button
            android:background="@null"
            android:id="@+id/clear"
            android:textSize="18sp"
            android:layout_marginTop="10dp"
            android:layout_gravity="center_horizontal"
            android:layout_marginLeft="100dp"
            android:text="清除搜索历史"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"/>
</LinearLayout>
```



###### question7item.xml

```xml
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
              android:orientation="horizontal"
              android:layout_width="match_parent"
              android:layout_height="match_parent">
    <ImageView
            android:background="@drawable/search"
            android:layout_width="32dp"
            android:layout_height="32dp"/>
    <TextView
            android:id="@+id/history"
            android:text="暂无查询记录"
            android:textColor="#000"
            android:textSize="20sp"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"/>
</LinearLayout>
```



###### Main10Activity.java

```java
package com.example.meta.question7;

import android.app.ProgressDialog;
import android.content.Intent;
import android.os.AsyncTask;
import android.util.Log;
import android.view.View;
import android.view.ViewGroup;
import android.widget.TextView;
import android.widget.Toast;
import androidx.annotation.NonNull;
import androidx.appcompat.app.AppCompatActivity;
import android.os.Bundle;
import androidx.recyclerview.widget.LinearLayoutManager;
import androidx.recyclerview.widget.RecyclerView;
import com.example.meta.R;
import okhttp3.*;
import org.json.JSONArray;
import org.json.JSONException;
import org.json.JSONObject;

import java.io.IOException;
import java.io.StreamCorruptedException;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

public class Main10Activity extends AppCompatActivity {

    private ProgressDialog progressDialog;
    private TextView number;
    private TextView site;
    private List<String> busData;
    private List<Map<String, Object>> otherData;
    private TextView name;
    private TextView time;
    private TextView info;
    private TextView price;
    private List<Map<String, Object>> data;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main10);
        initView();


        new MyAsync().execute();


    }

    private void initView() {
        name = findViewById(R.id.name);
        time = findViewById(R.id.time);
        info = findViewById(R.id.info);
        price = findViewById(R.id.price);
    }

    class MyAsync extends AsyncTask<Void, Void, List<Map<String, Object>>> {
        @Override
        protected void onPreExecute() {
            super.onPreExecute();
            show();
        }

        @Override
        protected List<Map<String, Object>> doInBackground(Void... voids) {

            //存储公交车线路的名字，最短路程，票价等所有信息
            data = new ArrayList<>();

            try {
                JSONObject object = new JSONObject(post("http://192.168.1.101:8088/transportservice/action/GetBusInfo.do", "{\"Line\":1,\"UserName\":\"user1\"}"));
                JSONArray array = new JSONArray(object.getString("ROWS_DETAIL"));
                for (int i = 0; i < array.length(); i++) {
                    JSONObject jsonObject = array.getJSONObject(i);
                    Map<String, Object> busData = new HashMap<>();
                    busData.put("name", jsonObject.getString("name"));
                    busData.put("mileage", jsonObject.getString("mileage"));
                    busData.put("ticket", jsonObject.getString("ticket"));
                    JSONArray sites = jsonObject.getJSONArray("sites");
                    JSONArray time = jsonObject.getJSONArray("time");
                    for (int j = 0; j < sites.length(); j++) {
                        Log.d("sitesObject", "doInBackground: " + sites.get(j));
                        busData.put("site" + j, sites.get(j));
                    }
                    for (int k = 0; k < time.length(); k++) {
                        busData.put("time" + k, time.get(k));
                    }
                    data.add(busData);
                }

            } catch (IOException e) {
                e.printStackTrace();
            } catch (JSONException e) {
                e.printStackTrace();
            }
            return data;
        }

        @Override
        protected void onPostExecute(List<Map<String, Object>> stringObjectMap) {
            super.onPostExecute(stringObjectMap);
            Intent intent = getIntent();
            String id = intent.getStringExtra("Id");
            int id1 = Integer.valueOf(id);
            Log.d("data", "onPostExecute: " + stringObjectMap.get(id1 - 1).get("site0"));
            dismiss();

            //需要查询公交车的所有其他信息
            otherData = new ArrayList<>();

            System.out.println(stringObjectMap.get(id1 - 1).get("time1"));

            for (int j = 0; j < 2; j++) {
                try {
                    JSONObject object = new JSONObject(String.valueOf(stringObjectMap.get(id1 - 1).get("time" + j)));
                    Map<String, Object> map = new HashMap<>();
                    map.put("site", object.getString("site"));
                    map.put("starttime", object.getString("starttime"));
                    map.put("endtime", object.getString("endtime"));
                    otherData.add(map);
                } catch (JSONException e) {
                    e.printStackTrace();
                }
            }

            System.out.println(otherData.toString());

            //需要查询公交车的所有站点信息
            busData = new ArrayList<>();
            for (int i = 0; i < stringObjectMap.get(id1 - 1).size(); i++)
                busData.add((String) stringObjectMap.get(id1 - 1).get("site" + i));

            Log.d("busData", "onPostExecute: " + busData.toString());
            //设置RecyclerView的布局方式
            RecyclerView recyclerView = findViewById(R.id.recyclerView);
            LinearLayoutManager linearLayoutManager = new LinearLayoutManager(getApplicationContext());
            linearLayoutManager.setOrientation(RecyclerView.VERTICAL);
            recyclerView.setLayoutManager(linearLayoutManager);
            MyAdapter adapter = new MyAdapter();
            recyclerView.setAdapter(adapter);
            name.setText(otherData.get(0).get("site") + "-" + otherData.get(1).get("site"));
            time.setText("" + otherData.get(0).get("starttime") + "-" + otherData.get(1).get("endtime"));
            price.setText("\t\t\t\t" + "票价：最高票价" + data.get(id1 - 1).get("ticket") + "元");
            info.setText("\t\t\t\t" + new MyAdapter().getItemCount() + "站/" + data.get(id1 - 1).get("mileage") + "公里");
            Intent intent1 = new Intent();
            intent.putExtra("item",otherData.get(0).get("site") + "-" + otherData.get(1).get("site"));
            setResult(RESULT_OK,intent);
        }
    }

    class MyAdapter extends RecyclerView.Adapter<MyAdapter.ViewHolder> {

        @NonNull
        @Override
        public ViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {
            View view = View.inflate(Main10Activity.this, R.layout.question72item, null);
            number = view.findViewById(R.id.number);
            site = view.findViewById(R.id.site);

            ViewHolder viewHolder = new ViewHolder(view);
            return viewHolder;
        }

        @Override
        public void onBindViewHolder(@NonNull ViewHolder holder, int position) {

            Log.d("busData", "onBindViewHolder: " + busData.toString());
            if (!busData.get(position).equals("")) {
                holder.site.setText(busData.get(position));
                holder.number.setText("" + (position + 1));
            }
        }


        @Override
        public int getItemCount() {
            return busData.size() - 5;
        }

        class ViewHolder extends RecyclerView.ViewHolder {

            private final TextView number;
            private final TextView site;

            public ViewHolder(@NonNull View itemView) {
                super(itemView);
                number = itemView.findViewById(R.id.number);
                site = itemView.findViewById(R.id.site);
            }
        }
    }


    public void show() {
        if (progressDialog == null) {
            progressDialog = new ProgressDialog(Main10Activity.this);
            progressDialog.setTitle("请稍等...");
            progressDialog.setMessage("正在加载中...");
            progressDialog.setCanceledOnTouchOutside(false);
            progressDialog.show();
        } else
            progressDialog.show();
    }

    public void dismiss() {
        if (progressDialog != null) progressDialog.dismiss();
    }

    //    使用okhttp发送一个post请求,接收一个地址参数和一个Json类型的参数
    public static String post(String address, String json) throws IOException {
        OkHttpClient client = new OkHttpClient();

        RequestBody requestBody = FormBody.create(MediaType.parse("application/json; charset=utf-8"), json);
        Request request = new Request.Builder()
                .url(address)//请求的url
                .post(requestBody)
                .build();
        return client.newCall(request).execute().body().string();
    }
}

```



###### activity_main10.xml

```xml
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout
        xmlns:android="http://schemas.android.com/apk/res/android"
        xmlns:tools="http://schemas.android.com/tools"
        android:layout_width="match_parent"
        android:layout_height="match_parent"
        tools:context=".question7.Main10Activity"
        android:orientation="vertical">
    <LinearLayout
            android:layout_width="match_parent"
            android:orientation="horizontal"
            android:layout_height="80dp">
        <LinearLayout
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:layout_gravity="center_horizontal|center_vertical"
                android:layout_marginLeft="50dp"
                android:orientation="vertical">
            <TextView
                    android:id="@+id/name"
                    android:textSize="25sp"
                    android:layout_width="wrap_content"
                    android:layout_height="wrap_content"/>
            <TextView
                    android:id="@+id/time"
                    android:textSize="25sp"
                    android:layout_width="wrap_content"
                    android:layout_height="wrap_content"/>
        </LinearLayout>
        <View
                android:layout_marginLeft="500dp"
                android:layout_width="1dp"
                android:layout_height="70dp"
                android:layout_gravity="center"
                android:background="#000"/>
        <Button
                android:background="@drawable/trans"
                android:layout_width="32dp"
                android:layout_height="32dp"
                android:layout_marginLeft="50dp"
                android:layout_gravity="center_vertical"/>

    </LinearLayout>
    <View
            android:layout_width="match_parent"
            android:layout_height="1dp"
            android:layout_marginLeft="10dp"
            android:layout_marginRight="10dp"
            android:background="#888"/>
    <LinearLayout
            android:layout_width="wrap_content"
            android:layout_height="80dp"
            android:layout_gravity="center_horizontal"
            android:orientation="horizontal">
        <TextView
                android:text="全程"
                android:gravity="center"
                android:textSize="30sp"
                android:layout_width="match_parent"
                android:layout_height="match_parent"/>
        <TextView
                android:textColor="#4169E1"
                android:id="@+id/info"
                android:gravity="center"
                android:textSize="25sp"
                android:layout_width="match_parent"
                android:layout_height="match_parent"/>
        <TextView
                android:id="@+id/price"
                android:gravity="center"
                android:textSize="20sp"
                android:layout_width="match_parent"
                android:layout_height="match_parent"/>
    </LinearLayout>
    <androidx.recyclerview.widget.RecyclerView
            android:layout_marginLeft="100dp"
            android:id="@+id/recyclerView"
            android:layout_width="match_parent"
            android:layout_height="match_parent"/>

</LinearLayout>
```



###### question72item.xml

```xml
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
              android:orientation="vertical"
              android:layout_width="match_parent"
              android:layout_height="match_parent">
    <LinearLayout android:orientation="horizontal"
                  android:layout_width="wrap_content"
                  android:layout_height="wrap_content">
        <TextView
                android:id="@+id/number"
                android:layout_width="25dp"
                android:layout_height="25dp"
                android:gravity="center"
                android:background="@drawable/radio72"/>
        <TextView
                android:id="@+id/site"
                android:textSize="25sp"
                android:layout_marginTop="3dp"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"/>
    </LinearLayout>
    <View
            android:layout_width="1dp"
            android:layout_height="40dp"
            android:background="#7F00FF"
            android:layout_marginLeft="12dp"
           />
</LinearLayout>
```





### 简单的IP检测：

此代码较为繁琐，有待优化！

```xml
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout
        xmlns:android="http://schemas.android.com/apk/res/android"
        xmlns:tools="http://schemas.android.com/tools" xmlns:app="http://schemas.android.com/apk/res-auto"
        android:orientation="vertical"
        android:layout_width="match_parent"
        android:background="@drawable/login"
        android:layout_height="match_parent"
        tools:context=".setting.Main4Activity">
    <include layout="@layout/mybar"/>
    <LinearLayout
            android:orientation="horizontal"
            android:layout_width="match_parent"
            android:gravity="center_horizontal|center_vertical"
            android:layout_height="300dp">

        <com.google.android.material.textfield.TextInputLayout
                android:id="@+id/textinput1"
                android:layout_width="wrap_content"
                app:errorEnabled="true"
                android:layout_height="wrap_content">
            <EditText
                    android:id="@+id/ed_1"
                    android:layout_width="150dp"
                    android:textSize="30sp"
                    android:gravity="center_horizontal"
                    android:layout_height="wrap_content"
                    android:inputType="number"
                    android:maxLines="1"
                    android:maxLength="3"/>

        </com.google.android.material.textfield.TextInputLayout>
        <com.google.android.material.textfield.TextInputLayout
                android:layout_width="wrap_content"
                android:id="@+id/textinput2"
                app:errorEnabled="true"
                android:layout_height="wrap_content">
            <EditText
                    android:id="@+id/ed_2"
                    android:layout_width="150dp"
                    android:textSize="30sp"
                    android:gravity="center_horizontal"
                    android:layout_height="wrap_content"
                    android:inputType="number"
                    android:maxLines="1"
                    android:maxLength="3"/>

        </com.google.android.material.textfield.TextInputLayout>
        <com.google.android.material.textfield.TextInputLayout
                android:layout_width="wrap_content"
                app:errorEnabled="true"
                android:id="@+id/textinput3"
                android:layout_height="wrap_content">
            <EditText
                    android:id="@+id/ed_3"
                    android:layout_width="150dp"
                    android:textSize="30sp"
                    android:gravity="center_horizontal"
                    android:layout_height="wrap_content"
                    android:inputType="number"
                    android:maxLines="1"
                    android:maxLength="3"/>

        </com.google.android.material.textfield.TextInputLayout>
        <com.google.android.material.textfield.TextInputLayout
                android:layout_width="wrap_content"
                android:id="@+id/textinput4"
                app:errorEnabled="true"
                android:layout_height="wrap_content">
            <EditText
                    android:id="@+id/ed_4"
                    android:layout_width="150dp"
                    android:textSize="30sp"
                    android:gravity="center_horizontal"
                    android:layout_height="wrap_content"
                    android:inputType="number"
                    android:maxLines="1"
                    android:maxLength="3"/>

        </com.google.android.material.textfield.TextInputLayout>


    </LinearLayout>
    <Button
            android:id="@+id/ok"
            android:text="确定"
            android:textColor="#FFF"
            android:background="#3B8CDE"
            android:layout_width="200dp"
            android:layout_gravity="center_horizontal"
            android:layout_height="wrap_content"/>
</LinearLayout>
```



```java
package com.example.transport.setting;

import android.text.Editable;
import android.text.TextWatcher;
import android.util.Log;
import android.view.View;
import android.widget.Button;
import android.widget.EditText;
import android.widget.TextView;
import android.widget.Toast;
import androidx.appcompat.app.AppCompatActivity;
import android.os.Bundle;
import com.example.transport.R;
import com.google.android.material.textfield.TextInputLayout;

import java.util.regex.Matcher;
import java.util.regex.Pattern;

public class Main4Activity extends AppCompatActivity implements View.OnClickListener {

    public static String IP;
    private EditText ed1;
    private EditText ed2;
    private EditText ed3;
    private EditText ed4;
    private String pattern = "(2(5[0-5]|[0-4]\\d))|[0-1]?\\d{1,2}";

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main4);

        initView();
    }

    private void initView() {
        TextView title = findViewById(R.id.title_text);
        title.setText("IP设置");

        Button button = findViewById(R.id.back_button);
        button.setOnClickListener(this);
        Button ok = findViewById(R.id.ok);
        ok.setOnClickListener(this);
        final TextInputLayout textinput1 = findViewById(R.id.textinput1);
        final TextInputLayout textinput2 = findViewById(R.id.textinput2);
        final TextInputLayout textinput3 = findViewById(R.id.textinput3);
        final TextInputLayout textinput4 = findViewById(R.id.textinput4);
        ed1 = findViewById(R.id.ed_1);
        ed2 = findViewById(R.id.ed_2);
        ed3 = findViewById(R.id.ed_3);
        ed4 = findViewById(R.id.ed_4);
        ed1.addTextChangedListener(new TextWatcher() {
            @Override
            public void beforeTextChanged(CharSequence s, int start, int count, int after) {

            }

            @Override
            public void onTextChanged(CharSequence s, int start, int before, int count) {
                if (!Pattern.compile(pattern).matcher(String.valueOf(ed1.getText())).matches()||String.valueOf(ed1.getText()).equals("0")) {
                    textinput1.setError("IP格式错误！");
                    textinput1.setErrorEnabled(true);
                } else textinput1.setErrorEnabled(false);
            }

            @Override
            public void afterTextChanged(Editable s) {

            }
        });
        ed2.addTextChangedListener(new TextWatcher() {
            @Override
            public void beforeTextChanged(CharSequence s, int start, int count, int after) {

            }

            @Override
            public void onTextChanged(CharSequence s, int start, int before, int count) {
                if (!Pattern.compile(pattern).matcher(String.valueOf(ed2.getText())).matches()) {
                    textinput2.setError("IP格式错误！");
                    textinput2.setErrorEnabled(true);
                } else textinput2.setErrorEnabled(false);
            }

            @Override
            public void afterTextChanged(Editable s) {

            }
        });
        ed3.addTextChangedListener(new TextWatcher() {
            @Override
            public void beforeTextChanged(CharSequence s, int start, int count, int after) {

            }

            @Override
            public void onTextChanged(CharSequence s, int start, int before, int count) {
                if (!Pattern.compile(pattern).matcher(String.valueOf(ed3.getText())).matches()) {
                    textinput3.setError("IP格式错误！");
                    textinput3.setErrorEnabled(true);
                } else textinput3.setErrorEnabled(false);
            }

            @Override
            public void afterTextChanged(Editable s) {

            }
        });
        ed4.addTextChangedListener(new TextWatcher() {
            @Override
            public void beforeTextChanged(CharSequence s, int start, int count, int after) {

            }

            @Override
            public void onTextChanged(CharSequence s, int start, int before, int count) {
                if (!Pattern.compile(pattern).matcher(String.valueOf(ed4.getText())).matches()) {
                    textinput4.setError("IP格式错误！");
                    textinput4.setErrorEnabled(true);
                } else textinput4.setErrorEnabled(false);
            }

            @Override
            public void afterTextChanged(Editable s) {

            }
        });
    }

    @Override
    public void onClick(View v) {
        switch (v.getId()) {
            case R.id.back_button:
                finish();
                break;
            case R.id.ok:
                IP = ed1.getText() + "." + ed2.getText() + "." + ed3.getText() + "." + ed4.getText();
                pattern = "((2(5[0-5]|[0-4]\\d))|[0-1]?\\d{1,2})(\\.((2(5[0-5]|[0-4]\\d))|[0-1]?\\d{1,2})){3}";

                if (Pattern.compile(pattern).matcher(IP).matches()){
                    IP = ed1.getText() + "." + ed2.getText() + "." + ed3.getText() + "." + ed4.getText();
                    Toast.makeText(this,"IP设置成功！",Toast.LENGTH_SHORT).show();
                }else {
                    ed1.setText("");
                    ed2.setText("");
                    ed3.setText("");
                    ed4.setText("");
                    IP="";
                    Toast.makeText(this,"IP格式错误！请重新输入！",Toast.LENGTH_SHORT).show();
                }

                break;
        }
    }
}

```

